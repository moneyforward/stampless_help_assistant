name: Daily Git Update

# æ¯Žæ—¥æœ10æ™‚ã«å®Ÿè¡Œï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰ + æ‰‹å‹•å®Ÿè¡Œå¯èƒ½ + ãƒ—ãƒƒã‚·ãƒ¥æ™‚å®Ÿè¡Œ
on:
  push:
    branches: [ main, master ]  # mainã¾ãŸã¯masterãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥æ™‚
  schedule:
    - cron: '0 1 * * *'  # æ¯Žæ—¥1æ™‚å®Ÿè¡Œï¼ˆUTC = æ—¥æœ¬æ™‚é–“10æ™‚ï¼‰
  workflow_dispatch:     # æ‰‹å‹•å®Ÿè¡Œãƒœã‚¿ãƒ³

jobs:
  git-update:
    runs-on: ubuntu-latest

    steps:
    - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # å…¨å±¥æ­´ã‚’å–å¾—

    - name: Node.js 18.x ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: |
        npm ci

    - name: Gitè¨­å®š
      run: |
        git config --global user.name "Git Auto Update"
        git config --global user.email "auto-update@github.com"

    - name: Gitæ›´æ–°å®Ÿè¡Œ
      run: |
        echo "ðŸ“¦ stampless-help-assistant ãƒªãƒã‚¸ãƒˆãƒªã‚’æ›´æ–°ã—ã¾ã™..."
        echo "ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒ: $(git branch --show-current)"
        echo "æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ: $(git log --oneline -1)"

        # ãƒ—ãƒ«å®Ÿè¡Œ
        git pull origin main 2>/dev/null || git pull origin master 2>/dev/null || echo "ãƒ—ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ"

        echo "âœ… Gitæ›´æ–°å®Œäº†: $(date)"

    - name: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ç¢ºèª
      run: |
        echo "ðŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ç¢ºèª"
        ls -la
        echo ""
        echo "ðŸ“¦ package.jsonç¢ºèª"
        cat package.json | head -20

    - name: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šç¢ºèªï¼ˆå®‰å…¨ãªæ–¹æ³•ï¼‰
      run: |
        echo "ðŸ” ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª"
        if [ -f "config/database-config-simple.json" ]; then
          echo "âœ… database-config-simple.json å­˜åœ¨ã—ã¾ã™"
          echo "è¨­å®šå†…å®¹ï¼ˆä¸€éƒ¨ï¼‰:"
          cat config/database-config-simple.json | head -10
        else
          echo "âš ï¸  database-config-simple.json ãŒå­˜åœ¨ã—ã¾ã›ã‚“"
        fi

    - name: ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œãƒ†ã‚¹ãƒˆï¼ˆDBæŽ¥ç¶šãªã—ï¼‰
      run: |
        echo "ðŸ§ª ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œãƒ†ã‚¹ãƒˆ"
        echo "ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒžãƒ³ãƒ‰å®Ÿè¡Œ:"
        node -e "console.log('âœ… Node.jså®Ÿè¡Œãƒ†ã‚¹ãƒˆæˆåŠŸ')"
        echo ""
        echo "åˆ©ç”¨å¯èƒ½ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ:"
        npm run

    - name: æ›´æ–°çµæžœé€šçŸ¥
      run: |
        echo "## stampless-help-assistant è‡ªå‹•æ›´æ–°çµæžœ" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“… å®Ÿè¡Œæ—¥æ™‚: $(date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M')" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“¦ ãƒªãƒã‚¸ãƒˆãƒª: stampless-help-assistant" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ”§ Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³: $(node --version)" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“‹ npmãƒãƒ¼ã‚¸ãƒ§ãƒ³: $(npm --version)" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æˆåŠŸ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### å®Ÿè¡Œãƒ­ã‚°" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        echo "Gitè‡ªå‹•æ›´æ–°ãŒå®Œäº†ã—ã¾ã—ãŸ" >> $GITHUB_STEP_SUMMARY
        echo "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã‚’ç¢ºèªã—ã¾ã—ãŸ" >> $GITHUB_STEP_SUMMARY
        echo "ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸ" >> $GITHUB_STEP_SUMMARY
        echo "æ¬¡å›žå®Ÿè¡Œ: 24æ™‚é–“å¾Œ" >> $GITHUB_STEP_SUMMARY
        echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
